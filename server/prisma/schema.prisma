generator client { provider = "prisma-client-js" }
datasource db { provider = "postgresql"; url = env("DATABASE_URL") }

model Conversation {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  title     String?
  turns     Turn[]
  summary   String?
}

model Turn {
  id             String   @id @default(cuid())
  conversationId String
  role           String   // "user" | "assistant" | "tool" | "system"
  content        String
  toolName       String?
  toolArgs       Json?
  toolResult     Json?
  createdAt      DateTime @default(now())
  idx            Int
  Conversation   Conversation @relation(fields: [conversationId], references: [id])
}

model Doc {
  id        String   @id @default(cuid())
  source    String   // "upload" | "web" | "note"
  uri       String?
  title     String?
  createdAt DateTime @default(now())
  chunks    DocChunk[]
}

model DocChunk {
  id        String   @id @default(cuid())
  docId     String
  ord       Int
  text      String
  // store embedding as JSON array (local cosine in JS)
  embedding Json?
  createdAt DateTime @default(now())
  Doc       Doc      @relation(fields: [docId], references: [id])
}
